<!DOCTYPE html>
<meta charset="utf-8">
<style>
html, body{
	margin: 0;
	font-family: arial, sans-serif;
}

text {
	fill:black;
	font-size: 8px
}

#controls {
	position:absolute;
	top: 110px;
	left: 460px;
	cursor: pointer;
}
#controls .control,
#controls .control span {
	padding-top: 5px;
	padding-bottom: 5px;
	background-color: #67A9CF;

}
#controls .control td {
	border-top: 2px solid white;
	border-right: 2px solid white;
	padding: 5px;
	font-size: 11px;
	display: inline-block;
	width: 90px;
}

.selected{
	color: white;
}

text.scenar:hover, 
text.vysledky:hover {
	font-size: 14px;
	fill: #67A9CF;

}

</style>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<body>
<table id= "controls">	
	<tr class= "control"><td class = "stari">Nejstarší obce</td><td class = "mladi">Nejmladší obce</td></tr>
	<tr class= "control"><td class = "nezamestnani">Nezaměstnaní</td><td class = "zamestnani">Zaměstnaní</td></tr>
	<tr class= "control"><td class = "krimi">Nejvyšší kriminalita</td><td class = "nekrimi">Nejnižší &nbsp; kriminalita</td></tr>
	<tr class= "control"><td class = "husti">Největší hustota obyvatel</td><td class = "ridci">Nejmenší hustota obyvatel</td></tr>
	<tr class= "control"><td class = "zeman">Bašty Miloše Zemana</td><td class = "schwarzenberg">Bašty Karla Schwarzenberga</td></tr>
</table>
<script>
var width = 400,
	height = 400;
var xvolby = [];
var scenar2 = [];

var strany = {"obcane_cz":0, "liberalove_cz":0, "VV":0, "konzerv_strana":0, "KSCM":0, "koruna_ceska":0, "CSNS":0, "CSSD":0, "narodni_prosperita":0, "sdruzeni_pro_rep":0, "moravane":0, "SPOZ":0, "STOP":0, "TOP09":0, "evropsky_stred":0, "KDU-CSL":0, "cibulka":0, "CS_narod_socialisticka":0, "zeleni":0, "suverenita_bobo":0, "humanisticka_str":0, "pirati":0, "DSSS":0, "svobodni":0, "ODS":0, "klicove_hnuti":0};

var partaje = []
for (partaj in strany) {
	partaje.push(partaj)
}    

var svg = d3.select("body").append("svg")
		.attr("width", width + 60)
		.attr("height", height + 60);


var yscale = d3.scale.pow()
		.exponent(.25)
		.domain([0, 30])
		.range([0, height - 40]);

function procenta(filtered) {
	var celkem = 0
	var out = []
for (i in strany){strany[i]=0;}
	var soucty = (filtered.reduce(function(s,e){
		for (i in s){
			s[i] += e[i] * 1.0;
		}
		return s;
	},strany));
		for (i in soucty){
			celkem += soucty[i] 
		}
		for (i in soucty){
			soucty[i] = (soucty[i]/celkem) * 100
		}
		for (var k in soucty) {
			out.push(soucty[k] )
		}
		return out

}

function updateChart(podminka) {
	var vysledkyFilter = xvolby.filter(function(e){return podminka(e)});
	var scenar = procenta(vysledkyFilter)					

	svg.selectAll("text.scenar")
		.data(scenar)
		.transition()
		.duration(700)
		.attr("y", function(d) { return height - yscale(d)})
		.text(function(d,i) {return partaje[i] + " " + Math.round(d) + " %"});		

	svg.selectAll("line")
		.data(scenar2)
		.transition()
		.duration(700)
		.attr("y1", function(d) { return height - yscale(d)})
		.attr("y2", function(d, i) { return height - yscale(scenar[i])})
		.attr("stroke", function(d, i) {
			if (d >= scenar[i]) {
				return "red"
			} else {
				return "green"
			}
	});
				};

d3.csv("volby10.csv", function(error, volby) {
	xvolby = volby
	var vysledkyFilter = volby.filter(function(e){return e.vek_prumer > 1});

	var scenar = procenta(vysledkyFilter)
	scenar2 = procenta(volby)

svg.selectAll("text.vysledky")
	.data(scenar2)
	.enter().append("text")
	.attr("x", 0)
	.attr("class", "vysledky")
	.attr("y", function(d) { return height - yscale(d)})
	.text(function(d,i) {return partaje[i] + " " + Math.round(d) + " %"});	


svg.selectAll("text.scenar")
	.data(scenar)
	.enter().append("text")
	.attr("x", 330)
	.attr("class", "scenar")
	.attr("y", function(d) { return height - yscale(d)})
	.text(function(d,i) {return partaje[i] + " " + Math.round(d) + " %"});		

svg.selectAll("g")
	.data(scenar2)
	.enter()
	.append("line")
	.attr("x1", 90)
	.attr("y1", function(d) { return height - yscale(d)})
	.attr("x2", 328)
	.attr("y2", function(d, i) { return height - yscale(scenar[i])})
	.attr("stroke-width", 1)
	.attr("stroke", function(d, i) {
		if (d > scenar[i]) {
			return "red"
		} else if (d < scenar[i]) {
			return "green"
		} else {
			return "gray"
		}
	});

});

d3.select(".stari").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.vek_prumer >= 50;})})
d3.select(".mladi").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.vek_prumer >= 50})})
d3.select(".nezamestnani").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.MIRA_NEZAM > 15})})
d3.select(".zamestnani").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.MIRA_NEZAM > 15})})
d3.select(".krimi").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.crimeRate > .05})})
d3.select(".nekrimi").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.crimeRate > .05})})
d3.select(".husti").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.hustotaObyv > .000120016285})})
d3.select(".ridci").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.hustotaObyv > .000120016285})})
d3.select(".zeman").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.hustotaObyv > .000120016285})})
d3.select(".schwarzenberg").on("click", function() {$("*").removeClass("selected"); $(this).addClass("selected"); updateChart(function(e){return e.hustotaObyv > .000120016285})})
</script>